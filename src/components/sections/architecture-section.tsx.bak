'use client';

import React, { useEffect, useState } from 'react';
import { motion, useInView } from 'framer-motion';
import { useRef } from 'react';
import { Bot, Shield, Zap, Search, Eye, Mic2, Activity, Database, Lock, Share2, ShieldCheck, Fingerprint } from 'lucide-react';

export function ArchitectureSection() {
    const [mounted, setMounted] = useState(false);
    const [telemetry, setTelemetry] = useState<string[]>([]);

    useEffect(() => {
        setMounted(true);
        setTelemetry([...Array(20)].map(() => Math.random().toString(16).slice(2, 10).toUpperCase()));
    }, []);
    const ref = useRef(null);
    const isInView = useInView(ref, { once: true, margin: "-100px" });

    const cardVariants = {
        hidden: { opacity: 0, y: 30 },
        visible: {
            opacity: 1,
            y: 0,
            transition: {
                duration: 0.8,
                ease: [0.16, 1, 0.3, 1] as any
            }
        }
    };

    return (
        <section id="architecture" className="relative py-24 sm:py-32 px-4 sm:px-6 overflow-hidden bg-background" ref={ref}>
            {/* Background Grid */}
            <div className="absolute inset-0 bg-[linear-gradient(to_right,#80808012_1px,transparent_1px),linear-gradient(to_bottom,#80808012_1px,transparent_1px)] bg-[size:60px:60px] [mask-image:radial-gradient(ellipse_60%_50%_at_50%_0%,#000_70%,transparent_100%)] -z-10" />

            <div className="max-w-7xl mx-auto relative z-10">
                <div className="flex flex-col items-center text-center max-w-3xl mx-auto mb-20 sm:mb-28">
                    <motion.div
                        initial={{ opacity: 0, scale: 0.9 }}
                        whileInView={{ opacity: 1, scale: 1 }}
                        className="px-4 py-1 rounded-full bg-highlight/10 border border-highlight/20 text-highlight text-[10px] font-bold uppercase tracking-[0.3em] mb-8"
                    >
                        Next-Gen Multi-Agent AI
                    </motion.div>
                    <h2 className="text-4xl sm:text-5xl md:text-6xl font-bold mb-8 tracking-tight text-white leading-tight">
                        The Command Center for <br /><span className="text-brand">Technical Truth</span>
                    </h2>
                    <p className="text-lg sm:text-xl text-text-secondary leading-relaxed max-w-2xl mb-6">
                        TalentLyt isn't just an interview tool. It's a high-precision verification engine
                        where multiple specialized agents maintain a continuous consensus on candidate integrity.
                    </p>
                </div>

                <div className="grid grid-cols-1 lg:grid-cols-3 gap-8 lg:gap-12 relative">
                    {/* Maya Card */}
                    <motion.div
                        variants={cardVariants}
                        initial="hidden"
                        whileInView="visible"
                        viewport={{ once: true }}
                        className="group relative p-8 rounded-[3.5rem] bg-card/30 border border-white/5 hover:border-brand/20 transition-all flex flex-col backdrop-blur-md overflow-hidden"
                    >
                        <div className="absolute -top-24 -right-24 w-96 h-96 bg-brand/10 blur-[100px] rounded-full -z-10 group-hover:bg-brand/20 transition-colors" />

                        <div className="flex items-center gap-5 mb-10">
                            <div className="w-16 h-16 rounded-[1.25rem] bg-brand/10 border border-brand/20 flex items-center justify-center text-brand">
                                <Bot className="w-9 h-9" />
                            </div>
                            <div>
                                <h3 className="text-2xl font-bold text-white mb-1">Maya</h3>
                                <div className="text-[10px] text-brand font-bold uppercase tracking-[0.2em]">Conversational Lead</div>
                            </div>
                        </div>

                        <div className="relative aspect-[4/3] rounded-3xl mb-10 overflow-hidden border border-white/10 bg-black/50 shadow-2xl group/core">
                            {/* Animated Scanning Beam */}
                            <motion.div
                                animate={{ top: ['-10%', '110%'] }}
                                transition={{ repeat: Infinity, duration: 3, ease: "linear", repeatDelay: 1 }}
                                className="absolute left-0 right-0 h-[2px] bg-gradient-to-r from-transparent via-brand to-transparent opacity-50 blur-sm z-30"
                            />
                            <motion.div
                                animate={{ top: ['-10%', '110%'] }}
                                transition={{ repeat: Infinity, duration: 3, ease: "linear", repeatDelay: 1 }}
                                className="absolute left-0 right-0 h-[20px] bg-gradient-to-r from-transparent via-brand/20 to-transparent blur-md z-30"
                            />

                            <img src="/assets/maya.png" alt="Maya Visual" className="w-full h-full object-cover transition-all duration-1000 group-hover:scale-105 brightness-[1.1]" />
                            <div className="absolute inset-0 bg-gradient-to-t from-background/80 via-transparent to-transparent opacity-60" />

                            {/* Animated Status Overlays */}
                            {mounted && (
                                <>
                                    {/* Top Right Status Badges */}
                                    <motion.div
                                        initial={{ opacity: 0, x: 20 }}
                                        animate={{ opacity: 1, x: 0 }}
                                        transition={{ delay: 0.5, duration: 0.6 }}
                                        className="absolute top-4 right-4 space-y-2 z-40"
                                    >
                                        <div className="flex items-center gap-2 px-3 py-1.5 rounded-lg bg-black/70 backdrop-blur-md border border-brand/30">
                                            <div className="w-1.5 h-1.5 rounded-full bg-brand animate-pulse" />
                                            <span className="text-[9px] font-mono text-white/60 uppercase tracking-wider">Voice Active</span>
                                            <span className="text-[10px] font-bold text-brand">100Hz</span>
                                        </div>
                                        <div className="flex items-center gap-2 px-3 py-1.5 rounded-lg bg-black/70 backdrop-blur-md border border-cyan-500/30">
                                            <div className="w-1.5 h-1.5 rounded-full bg-cyan-400 animate-pulse" />
                                            <span className="text-[9px] font-mono text-white/60 uppercase tracking-wider">Context Depth</span>
                                            <span className="text-[10px] font-bold text-cyan-400">Active</span>
                                        </div>
                                    </React.Fragment>

                                    {/* Bottom Left Status */}
                                    <motion.div
                                        initial={{ opacity: 0, y: 20 }}
                                        animate={{ opacity: 1, y: 0 }}
                                        transition={{ delay: 0.8, duration: 0.6 }}
                                        className="absolute bottom-4 left-4 z-40"
                                    >
                                        <div className="px-4 py-2.5 rounded-xl bg-black/70 backdrop-blur-md border border-brand/30">
                                            <div className="text-[8px] font-mono text-brand uppercase tracking-widest mb-1">Agent Status</div>
                                            <div className="flex items-center gap-2">
                                                <div className="w-2 h-2 rounded-full bg-green-400 animate-pulse" />
                                                <span className="text-sm font-bold text-white">Maya Interactive</span>
                                            </div>
                                        </div>
                                    </motion.div>

                                    {/* Bottom Right Live Indicator */}
                                    <motion.div
                                        initial={{ opacity: 0, scale: 0.8 }}
                                        animate={{ opacity: 1, scale: 1 }}
                                        transition={{ delay: 1, duration: 0.5 }}
                                        className="absolute bottom-4 right-4 z-40"
                                    >
                                        <div className="px-3 py-1.5 rounded-lg bg-black/70 backdrop-blur-md border border-brand/40">
                                            <div className="flex items-center gap-2">
                                                <span className="text-[9px] font-mono text-white/50 uppercase tracking-wider">AI Interviewer</span>
                                                <div className="flex items-center gap-1.5">
                                                    <div className="w-1.5 h-1.5 rounded-full bg-red-500 animate-pulse" />
                                                    <span className="text-[10px] font-bold text-white">MAYA LIVE</span>
                                                </div>
                                            </div>
                                        </div>
                                    </motion.div>
                                </>
                            )}
                        </div>

                        <div className="space-y-4">
                            {[
                                { icon: Mic2, text: "Natural Conversation", desc: "Human-like Nova voice feedback" },
                                { icon: Database, text: "RAG-Powered Questions", desc: "Role-specific context injection" },
                                { icon: Activity, text: "Adaptive Difficulty", desc: "Junior to Staff progression" }
                            ].map((item, i) => (
                                <div key={i} className="flex gap-4 items-start group/item">
                                    <div className="mt-1 w-8 h-8 rounded-lg bg-white/5 border border-white/10 flex items-center justify-center shrink-0 group-hover/item:bg-brand/10 group-hover/item:border-brand/20 transition-colors">
                                        <item.icon className="w-4 h-4 text-text-muted group-hover/item:text-brand" />
                                    </div>
                                    <div>
                                        <div className="text-sm font-bold text-white mb-0.5">{item.text}</div>
                                        <div className="text-xs text-text-muted">{item.desc}</div>
                                    </div>
                                </div>
                            ))}
                        </div>
                    </motion.div>

                    {/* Guardrails Card (The Security Layer) */}
                    <motion.div
                        variants={cardVariants}
                        initial="hidden"
                        whileInView="visible"
                        viewport={{ once: true }}
                        className="group relative p-8 rounded-[3.5rem] bg-brand/5 border border-brand/20 hover:border-brand/40 transition-all flex flex-col backdrop-blur-md overflow-hidden lg:translate-y-12"
                    >
                        <div className="absolute inset-0 bg-[radial-gradient(circle_at_center,#2563eb10_0%,transparent_70%)]" />

                        <div className="flex items-center gap-5 mb-10">
                            <div className="w-16 h-16 rounded-[1.25rem] bg-brand/20 border border-brand/30 flex items-center justify-center text-brand">
                                <Shield className="w-9 h-9" />
                            </div>
                            <div>
                                <h3 className="text-2xl font-bold text-white mb-1">NeMo Guardrails</h3>
                                <div className="text-[10px] text-brand font-bold uppercase tracking-[0.2em]">The Security Layer</div>
                            </div>
                        </div>

                        <div className="flex-1 flex flex-col justify-center space-y-8 relative py-8">
                            <div className="absolute left-1/2 -translate-x-1/2 top-0 bottom-0 w-px bg-gradient-to-b from-transparent via-brand/20 to-transparent" />

                            {[
                                { label: "Jailbreak Detection", status: "SECURE" },
                                { label: "Off-Topic Filtering", status: "ACTIVE" },
                                { label: "Help Rejection", status: "LOCKED" },
                                { label: "RAG Verification", status: "SYNCED" }
                            ].map((rail, idx) => (
                                <motion.div
                                    key={idx}
                                    whileHover={{ scale: 1.05 }}
                                    className="relative z-10 mx-auto px-6 py-4 rounded-2xl bg-black/60 border border-brand/20 backdrop-blur-xl w-full max-w-[200px] flex flex-col items-center gap-2 group/rail hover:border-brand/40 transition-all"
                                >
                                    <span className="text-[10px] font-bold text-white/60 group-hover/rail:text-white transition-colors">{rail.label}</span>
                                    <div className="flex items-center gap-2">
                                        <div className="w-1 h-1 rounded-full bg-brand animate-pulse" />
                                        <span className="text-[8px] font-mono text-brand uppercase tracking-widest">{rail.status}</span>
                                    </div>
                                </motion.div>
                            ))}
                        </div>

                        <div className="mt-8 pt-8 border-t border-brand/10">
                            <p className="text-xs text-brand/60 font-medium text-center italic">
                                Enterprise security against manipulation and LLM jailbreaking.
                            </p>
                        </div>
                    </motion.div>

                    {/* Audit Sentinel Card */}
                    <motion.div
                        variants={cardVariants}
                        initial="hidden"
                        whileInView="visible"
                        viewport={{ once: true }}
                        className="group relative p-8 rounded-[3.5rem] bg-card/30 border border-white/5 hover:border-warning/20 transition-all flex flex-col backdrop-blur-md overflow-hidden"
                    >
                        <div className="absolute -top-24 -right-24 w-96 h-96 bg-warning/5 blur-[100px] rounded-full -z-10 group-hover:bg-warning/10 transition-colors" />

                        <div className="flex items-center gap-5 mb-10">
                            <div className="w-16 h-16 rounded-[1.25rem] bg-warning/10 border border-warning/20 flex items-center justify-center text-warning">
                                <Fingerprint className="w-9 h-9" />
                            </div>
                            <div>
                                <h3 className="text-2xl font-bold text-white mb-1">Audit Sentinel</h3>
                                <div className="text-[10px] text-warning font-bold uppercase tracking-[0.2em]">The Truth Engine</div>
                            </div>
                        </div>

                        <div className="relative aspect-[4/3] rounded-3xl mb-10 overflow-hidden border border-white/10 bg-black/50 shadow-2xl group/core">
                            {/* Micro-Telemetry Stream */}
                            <div className="absolute inset-y-0 left-4 w-12 py-8 overflow-hidden pointer-events-none opacity-20">
                                {mounted && (
                                    <motion.div
                                        animate={{ y: [0, -100] }}
                                        transition={{ repeat: Infinity, duration: 2, ease: "linear" }}
                                        className="font-mono text-[6px] text-warning space-y-1"
                                    >
                                        {telemetry.map((val, i) => (
                                            <div key={i}>{val}</div>
                                        ))}
                                    </motion.div>
                                )}
                            </div>

                            <img src="/assets/governor.jpg" alt="Audit Sentinel Visual" className="w-full h-full object-cover group-hover:scale-110 transition-all duration-1000 grayscale brightness-75" />
                            <div className="absolute inset-0 bg-gradient-to-t from-background/80 via-transparent to-transparent opacity-80" />

                            {/* Animated Scanning Beam */}
                            <motion.div
                                animate={{ top: ['-10%', '110%'] }}
                                transition={{ repeat: Infinity, duration: 2.5, ease: "linear", repeatDelay: 0.5 }}
                                className="absolute left-0 right-0 h-[2px] bg-gradient-to-r from-transparent via-warning to-transparent opacity-60 blur-sm z-30"
                            />
                            <motion.div
                                animate={{ top: ['-10%', '110%'] }}
                                transition={{ repeat: Infinity, duration: 2.5, ease: "linear", repeatDelay: 0.5 }}
                                className="absolute left-0 right-0 h-[20px] bg-gradient-to-r from-transparent via-warning/30 to-transparent blur-md z-30"
                            />

                            {/* Animated Status Overlays */}
                            {mounted && (
                                <>
                                    {/* Top Right Metrics */}
                                    <motion.div
                                        initial={{ opacity: 0, x: 20 }}
                                        animate={{ opacity: 1, x: 0 }}
                                        transition={{ delay: 0.5, duration: 0.6 }}
                                        className="absolute top-4 right-4 space-y-2 z-40"
                                    >
                                        <div className="flex items-center gap-2 px-3 py-1.5 rounded-lg bg-black/70 backdrop-blur-md border border-warning/30">
                                            <ShieldCheck className="w-3 h-3 text-warning" />
                                            <span className="text-[9px] font-mono text-white/60 uppercase tracking-wider">Integrity Scan</span>
                                            <span className="text-[11px] font-bold text-warning">99.8%</span>
                                        </div>
                                        <div className="flex items-center gap-2 px-3 py-1.5 rounded-lg bg-black/70 backdrop-blur-md border border-green-500/30">
                                            <Database className="w-3 h-3 text-green-400" />
                                            <span className="text-[9px] font-mono text-white/60 uppercase tracking-wider">Truth Index</span>
                                            <span className="text-[10px] font-bold text-green-400">Verified</span>
                                        </div>
                                    </React.Fragment>

                                    {/* Bottom Right Forensic Badge */}
                                    <motion.div
                                        initial={{ opacity: 0, y: 20 }}
                                        animate={{ opacity: 1, y: 0 }}
                                        transition={{ delay: 0.8, duration: 0.6 }}
                                        className="absolute bottom-4 right-4 z-40"
                                    >
                                        <div className="flex items-center gap-3 px-4 py-2 rounded-xl bg-black/70 backdrop-blur-md border border-warning/30">
                                            <Lock className="w-4 h-4 text-warning animate-pulse" />
                                            <span className="technical-label text-warning uppercase">Forensic Active</span>
                                        </div>
                                    </motion.div>

                                    {/* Bottom Left Audit Status */}
                                    <motion.div
                                        initial={{ opacity: 0, scale: 0.8 }}
                                        animate={{ opacity: 1, scale: 1 }}
                                        transition={{ delay: 1, duration: 0.5 }}
                                        className="absolute bottom-4 left-4 z-40"
                                    >
                                        <div className="px-3 py-1.5 rounded-lg bg-black/70 backdrop-blur-md border border-warning/40">
                                            <div className="flex items-center gap-2">
                                                <div className="w-1.5 h-1.5 rounded-full bg-orange-500 animate-pulse" />
                                                <span className="text-[10px] font-bold text-white">AUDIT LIVE</span>
                                            </div>
                                        </div>
                                    </motion.div>
                                </>
                            )}
                        </div>

                        <div className="space-y-4">
                            {[
                                { icon: ShieldCheck, text: "Real-time Scoring", desc: "Q&A evaluated with 1-10 accuracy" },
                                { icon: Database, text: "RAG Verification", desc: "Cross-referenced against knowledge base" },
                                { icon: Activity, text: "Anomaly Detection", desc: "Script detection & latency analysis" }
                            ].map((item, i) => (
                                <div key={i} className="flex gap-4 items-start group/item">
                                    <div className="mt-1 w-8 h-8 rounded-lg bg-white/5 border border-white/10 flex items-center justify-center shrink-0 group-hover/item:bg-warning/10 group-hover/item:border-warning/20 transition-colors">
                                        <item.icon className="w-4 h-4 text-text-muted group-hover/item:text-warning" />
                                    </div>
                                    <div>
                                        <div className="text-sm font-bold text-white mb-0.5">{item.text}</div>
                                        <div className="text-xs text-text-muted">{item.desc}</div>
                                    </div>
                                </div>
                            ))}
                        </div>
                    </motion.div>
                </div>

                <motion.div
                    initial={{ opacity: 0, scale: 0.95 }}
                    whileInView={{ opacity: 1, scale: 1 }}
                    className="mt-16 p-10 rounded-[2.5rem] bg-white/[0.02] border border-white/5 flex flex-col md:flex-row items-center justify-between gap-12"
                >
                    <div className="max-w-2xl">
                        <div className="flex items-center gap-3 mb-4">
                            <div className="w-2 h-2 rounded-full bg-brand animate-pulse" />
                            <h4 className="text-xl font-bold text-white tracking-tight">Consensus Mechanism</h4>
                        </div>
                        <p className="text-base text-white/50 font-medium leading-relaxed">
                            Maya conducts the session while Governor verifies technical truth in real-time.
                        </p>
                    </div>
                    <div className="flex items-center gap-8 shrink-0">
                        <div className="flex -space-x-5">
                            {[1, 2, 3].map((i) => (
                                <div key={i} className="w-14 h-14 rounded-full border-4 border-[#0a0a0a] bg-muted overflow-hidden shadow-2xl">
                                    <img src={`https://i.pravatar.cc/100?img=${i + 30}`} alt="auditor" className="w-full h-full object-cover" />
                                </div>
                            ))}
                        </div>
                        <div className="text-center">
                            <div className="text-2xl font-bold text-white leading-none mb-1">2k+</div>
                            <div className="text-[10px] text-text-muted font-bold uppercase tracking-[0.2em]">Audits/Day</div>
                        </div>
                    </div>
                </motion.div>
            </div>
        </section>
    );
}
